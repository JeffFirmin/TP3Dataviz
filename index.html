<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://lyondataviz.github.io/teaching/lyon1-m2/2021/data/matrixManagement.js"></script>

  <style></style>
</head>

<body>
  <div id="matrice"></div>
  <script>
    // Definition de la taille du svg
    const margin = { top: 0, right: 30, bottom: 20, left: 10 },
      width = 960,
      height = 960;

    var color = d3
      .scaleQuantize()
      .range(["#edf8e9", "#bae4b3", "#74c476", "#31a354", "#006d2c"]);

    // ajout du svg à une 'div id="matrice"' déjà créee dans la page html
    var svg = d3
      .select("#matrice")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.json("GOT.json").then(function (json) {
      data = json;
      //console.log(json.edges);
      adjacencymatrix = createAdjacencyMatrix(json.nodes, json.links);
      //console.log(adjacencymatrix);

      var maxWeight = d3.max(adjacencymatrix, function (d) {
        return d.weight;
      });

      console.log(maxWeight);

      var scale = d3
        .scaleQuantize()
        .domain([0, maxWeight]) // TODO
        .range(d3.schemeBlues[9]);

      // Question 4:
      matrixViz = svg
        .selectAll("rect")
        .data(adjacencymatrix)
        .join("rect")
        .attr("width", 5) //TODO
        .attr("height", 5) //TODO
        .attr("x", function (d) {
          return d.x * 5;
        })
        .attr("y", function (d) {
          return d.y * 5;
        })
        .style("stroke", "black")
        .style("stroke-width", ".2px")
        .style("fill", function (d) {
          var value = d.weight;
          return scale(value);
        });
      // Question 5

      var positionsPersonnages = d3.range(json.nodes.length); // un tableau d'autant d'element que de personnages
      // [0, 1, ..., 106]
      var echellexy = d3
        .scaleBand()
        .range([0, width]) // TODO correspond [0, largeur du dessin]
        .domain(positionsPersonnages)
        .paddingInner(0.1)
        .align(0)
        .round(true);

      var labels = d3
        .select("svg")
        .append("g")
        .attr("transform", "translate(60, 60)")
        .style("font-size", "8px")
        .style("font-family", "sans-serif");

      var columns = labels
        .append("g")
        .selectAll()
        .data(json.nodes)
        .join("text")
        .attr("width", 5) //TODO
        .attr("height", 5) //TODO
        .attr("x", function (d) {
          return d.x * 5;
        })
        .attr("y", function (d) {
          return d.y * 5;
        })
        .attr("transform", "rotate(-90)"); // on tourne tout l'axe de 90°

      var rows = labels
        .append("g")
        .selectAll()
        .data(json.nodes)
        .join("text")
        .text((d) => d.character)
        .attr("width", 5) //TODO
        .attr("height", 5) //TODO
        .attr("x", function (d) {
          return d.x * 5;
        })
        .attr("y", function (d) {
          return d.y * 5;
        });
    });

    // donné par D3
  </script>
</body>
